#summary Description of Attachments extension
#labels Development

= Introduction =

*Attachments* is Magento extension that allows asynchronous file uploading in product page.


= Details =

== Problems to solve ==
  # Allow uploading multiple files per 1 custom product option in Magento.
  # Upload files as you go, asynchronously using queue to avoid hi stress on internet bandwidth.
  # Display list of uploaded files on every page where quote/order details are shown.
  # In frontend show the list in plain text format (no links to download files)
  # In admin order details page, display links to uploaded files so that admin user can download and use files.

== How are problems solved ==

  * Added to Magento is new custom option type 'attachment'. 
  * Currently it overrides existing type 'file'. 
  * Also added is product attribute 'use_ajax_upload' which is enabled/disabled type of attribute. When it is enabled, all attachment features are on, when disabled, the option functions as 'file'.
  * Added single template file catalog/product/view/options/type/attachments.phtml which partially repeats file.phtml content, but instead of directly displaying file upload widget it uses attachments/upload helper.
  * to implement asynchronous part a script called attachments.js is used. All functionality in it is implemented using Prototype framework http://www.prototypejs.org/api , this decision was made for some reasons, but most important is that Magento uses Prototype by default for its JS functionality so no new dependences are introduced.
  * Displaying part of extension is done via extending and overriding some of Magento classes.
   * Mage_Catalog_Model_Product_Option is overridden by ZetaPrints_Attachments_Model_Product_Option
   * Mage_Catalog_Model_Product_Option_Type_File is extended from ZetaPrints_Attachments_Model_Product_Option_Type_Attachments
  * Since whole operation is asynchronous we cannot use usual methods for adding custom option to quote, so this is handled via Magento event system and ZetaPrints_Attachments_Model_Events_Observer

== Usage ==

Admin user adds or edits a product that can use one or more customer files, such as visual templates, fonts, Photoshop brushes etc.

To provide this admin adds custom option from product editing page.

http://lh3.ggpht.com/_FUsMOYf2KgU/TQIxeESUg-I/AAAAAAAAAHE/jkKNsNyAsbw/admin_product_custom_option.png

Admin can choose as many file upload options as needed. For example, graphic designs, fonts, pdf files etc. 

Each chosen option will present separate widget that allows queuing multiple files for that option.

To enable AJAX upload admin has to set 'Use AJAX upload' to 'Yes' in general product attributes.

http://lh6.ggpht.com/_FUsMOYf2KgU/TQIxeBlfUUI/AAAAAAAAAHA/gFFm_mgNut8/admin_product_attribute_use_ajax.png

By default Magento disallows uploading of .php and .exe files.

A product with this option added, presents to user JavaScript powered file upload widget with looks consistent among major browsers.

http://lh5.ggpht.com/_FUsMOYf2KgU/TQIxlWrNNjI/AAAAAAAAAHY/wd434HaoyA4/s800/Test_Product_With_Ajax_Upload.png

Below each widget there is a reminder of maximum possible file size.

Uploading first file chosen for each option group starts immediately and each additional file is added to queue. 

Next to each uploading file is presented a 'cancel' button, that allows the customer to stop the upload if needed.

http://lh3.ggpht.com/_FUsMOYf2KgU/TQIxldFr0HI/AAAAAAAAAHU/Qq3doU5LFSE/s800/file_loading.png

Upon canceling upload of a file, next in queue starts upload. Canceled file is removed from queue and if customer wants to re - add it , has to choose it again.

Next to each queued file there is a 'remove' link which removes the file from queue. Clicking on that link will remove the file and its form from queue.

During upload, all 'Add to cart' buttons of original Magento form are hidden from client to prevent accidental leaving of the page and by doing this canceling all pending and running uploads. If customer decides that he does not want to upload remaining files, he/she can cancel or remove them and 'Add to cart' buttons will be available again.

After product has been added to cart, all uploaded files are listed in shopping cart, and then in checkout page. Upon order placing if customer is registered, she can see the list of uploaded files in order details page too.

In frontend of Magento files are not available for download, to prevent bandwidth over usage.

http://lh5.ggpht.com/_FUsMOYf2KgU/TQIxeFo2iTI/AAAAAAAAAHI/KARyFPXE-zQ/s800/file_in_cart.png

http://lh5.ggpht.com/_FUsMOYf2KgU/TQIxecZ9k6I/AAAAAAAAAHM/0B2fg5AG_Ns/s800/file_in_checkout.png

http://lh3.ggpht.com/_FUsMOYf2KgU/TQIxlJOYXFI/AAAAAAAAAHQ/O7g-dmSyXpU/s800/file_in_order.png

When examining the order in Admin - users are presented with download links to all files attached to order.

http://lh4.ggpht.com/_FUsMOYf2KgU/TQIxdw0673I/AAAAAAAAAG8/Ywf8PNB7dgw/admin_order_view.png