#summary How to integrate ZP into a custom theme
= Introduction =

This document explains changes you need to make to a custom magento theme to enable our web-to-print extension.

= Files in `app/design/frontend/default/<your_theme_name>/` =

Modify files behind the user interface.

==template/catalog/product/list.phtml==

  * Replace line 63 (add to cart button):
{{{
<button class="form-button" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><?php echo $this->__('Add to Cart') ?></span></button>
}}}

  with following code:
{{{
<?php if($_product->getData("w2p_image")): ?>
  <?php if(!$_product->getData("w2p_isorder")): ?>
    <input type="button" name="sosanh" value="PERSONALIZE" class="form-button" onclick="document.location='<?php echo $_product->getProductUrl() ?>?preview=1&order=';return false;"/>
  <?php endif; ?>
<?php else: ?>
  <button class="form-button" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><?php echo $this->__('Add to Cart') ?></span></button>
<?php endif; ?>
}}}

  The new code checks if the product has web-to-print features and is not an already customized product (an order). In this case it shows a _Personalize_ button instead of _Add to Cart_.

  * Replace line 108 (add to cart button):
{{{
<button type="button" class="form-button" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><?php echo $this->__('Add to Cart') ?></span></button>
}}}

  with following code:
{{{
<?php if($_product->getData("w2p_image")): ?>
  <?php if(!$_product->getData("w2p_isorder")): ?>
    <input type="button" name="sosanh" value="PERSONALIZE" class="form-button" onclick="document.location='<?php echo $_product->getProductUrl() ?>?preview=1&order=';return false;"/>
  <?php endif; ?>
<?php else: ?>
  <button class="form-button" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><?php echo $this->__('Add to Cart') ?></span></button>
<?php endif; ?>
}}}

  The new code checks if the product has web-to-print features and is not an already customized product (an order). In this case it shows a _Personalize_ button instead of _Add to Cart_.

==template/catalog/product/view/addtocart.phtml==

Replace lines 31-38 (add to cart button with wrapper html):

{{{
<fieldset class="add-to-cart-box">
  <legend><?php echo $this->__('Add Items to Cart') ?></legend>
  <?php if(!$_product->isGrouped()): ?>
    <span class="qty-box"><label for="qty"><?php echo $this->__('Qty') ?>:</label>
    <input name="qty" type="text" class="input-text qty" id="qty" maxlength="12" value="<?php echo $this->getMinimalQty($_product) ?>" /></span>
  <?php endif; ?>
  <button type="button" class="form-button" onclick="productAddToCartForm.submit()"><span><?php echo $this->__('Add to Cart') ?></span></button>
</fieldset>
}}}

with following code:

{{{
<?php if($_product->getData("w2p_image")): ?>
  <?php if(!$_product->getData("w2p_isorder")): ?>
    <input type="button" name="sosanh" value="PERSONALIZE" class="form-button" onclick="document.location='<?php echo $_product->getProductUrl() ?>?preview=1&order=';return false;"/>
  <?php endif; ?>
<?php else: ?>
  <fieldset class="add-to-cart-box">
    <legend><?php echo $this->__('Add Items to Cart') ?></legend>
    <?php if(!$_product->isGrouped()): ?>
      <span class="qty-box"><label for="qty"><?php echo $this->__('Qty') ?>:</label>
      <input name="qty" type="text" class="input-text qty" id="qty" maxlength="12" value="<?php echo $this->getMinimalQty($_product) ?>" /></span>
     <?php endif; ?>
     <button type="button" class="form-button" onclick="productAddToCartForm.submit()"><span><?php echo $this->__('Add to Cart') ?></span></button>
  </fieldset>
<?php endif; ?>
}}}

  This new code checks if the product has web-to-print features and is not an already customized product (an order). In this case it shows a _Personalize_ button instead of _Add to Cart_.

==template/catalog/product/view.phtml==

After line 36 (getting current product object):

`$_product = $this->getProduct();`

insert following code:

{{{
$button = "";
$img = $_product->getData("w2p_image");

if ($img && !$_product->getData("w2p_isorder")) {
  $button = '<input type="button" name="sosanh" value="PERSONALIZE" class="Personallize" onclick="document.location=\'' . $_product->getProductUrl() . '?preview=1&order=\';return false;"/>';
}

$is_preview = isset($_REQUEST['preview']);
$order = isset($_REQUEST['order']) ? $_REQUEST['order'] : "";

if (isset($_REQUEST['order']) && $_REQUEST['order']) {
  $is_preview = 0;
}

if ($order){
  $logic = Mage::getModel('api/w2puser');
  $ret = $logic->order($order);

  if ($ret > 0) {
    echo '<script type="text/javascript">parent.document.location="' . $this->getUrl('checkout/cart/add') . '?&qty=1&product=' . $ret .'";</script>';
  } else {
    echo '<script type="text/javascript">parent.document.location="' . $this->getUrl('checkout/cart') .'";</script>';
  }

  return;
}

if ($img && $is_preview) {
  $logic = Mage::getModel('api/w2puser');
  $id = trim($_product->getSku());
  $w2p_url = $logic->getPersonalizeUrl($id);

  echo '<iframe src="' . $w2p_url .'" width="100%" height="1800px"></iframe>';

  return;
}
}}}

  This new code checks what user is doing with product: making an order or personalizing it. In case of order it shows ordering page otherwise it shows an IFRAME with contents from ZP.

==template/page/2columns-right.phtml==

  * Before line 31:
{{{
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
}}}

  insert code:
{{{
<?php $is_preview = isset($_REQUEST['preview']); ?>
}}}

  Checking if _Personalize_ button is clicked.

  * After line 36:
{{{
<body <?php echo $this->getBodyClass()?'class="'.$this->getBodyClass().'"':'' ?>>
}}}

  insert code:
{{{
<?php if (!$is_preview): ?>
}}}

  If _Personalize_ button isn't clicked show normal page.

  * After line 81:
{{{
<?php echo $this->getAbsoluteFooter() ?>
}}}

  insert code:
{{{
<?php else: ?>
  <div class="wrapper">
    <div class="header">
      <?php echo $this->getChildHtml('header') ?>
    </div>
  </div>

  <?php echo $this->getChildHtml('content') ?>
  <div class="wrapper">
    <div class="footer">
      <?php echo $this->getChildHtml('footer') ?>
    </div>
  </div>
<?php endif; ?>
}}}

  If _Personalize_ button is clicked show page without content. It'll be filled with iframe content.