#summary Integration of w2p into a custom theme
#labels Integration

= Introduction =

The web-to-print extension comes with a default theme modified to include all the necessary code from the extension. A Magento website can use a different theme modified to include the code as explained in this manual.

  # Read this manual
  # Study the default theme files
  # Transfer the code from the default theme to your custom theme
  # Test on w2p and non-w2p products

*Disclaimer*: theme modifications require a certain level of programming skill. 

All files listed here can be found in [http://www.magentocommerce.com/extension/1586 extension] on Magento-Connect or in the [http://code.google.com/p/magento-w2p/source/checkout svn repository].

Every file has the new code divided into several sections. Every section has its sequence number (e.g. ZP-CODE:1) and is enclosed with comments similar to this:

{{{
/****** ZP-CODE:1 Short description of code in the block ******/

some code

/****** ZP-CODE:1 End ******/
}}}

= Personalization form =
The form is a modified product details page. You need to insert certain function calls at places where the blocks of HTML should show. This screenshot is only a guide to how it can be laid out on the screen. The functions are described below in the article.
http://www.zetaprints.com/magento-docs/theme-configuration.png

= Custom theme requirements = 

The web-to-print extension has several requirements to HTML code of the custom theme.

  * _app/design/frontend/default/`<`your_custom_theme_name`>`/template/catalog/product/view.phtml_
  Set *id* attribute of preview image container (can be a parent, but not immediate one) to *zetaprints-preview-image-container* value. Search for _zetaprints-preview-image-container_ string in [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/catalog/product/view.phtml view.phtml] file from _zptheme_ theme for example.
  * _app/design/frontend/default/`<`your_custom_theme`>`/template/catalog/product/view/addtocart.phtml_
  Set *id* attribute of _Add to cart_ button to *zetaprints-add-to-cart-button* value. Search for _zetaprints-add-to-cart-button_ string in [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/catalog/product/view/addtocart.phtml addtocart.phtml] file from _zptheme_ theme for example.
  * _app/design/frontend/default/`<`your_custom_theme`>`/template/catalog/product/view/media.phtml_
  Set *id* attribute of product image tag to *image* value. Search for _image_ string in [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/catalog/product/view/media.phtml media.phtml] file from _zptheme_ theme for example

= Files in `app/design/frontend/default/<your_theme_name>/` =

You need to modify some files behind the user interface.

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/catalog/product/view.phtml template/catalog/product/view.phtml] ==
This file shows form for ordering on product page. This form contains product images, product name, product description, product price, etc.

New code checks for web-to-print features in a product and adds additional options (ajax image preview, colour picker, stock images chooser and support for multipage templates).

The code is divided into 4 sections.

*Section 1*: checking if a product has web-to-print features then printing tabs component for switching pages in multipage templates.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_page_tabs($this); ?>
  }}}

*Section 2*: checking if Ð° product has web-to-print features then printing text fields, stock images choosers, color pickers.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_text_fields($this); ?>
<?php $this->helper('webtoprint/personalization-form')->get_image_fields($this); ?>
  }}}

*Section 3*: checking if a product has web-to-print features then printing _Update preview_ button.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_preview_button($this); ?>
  }}}

*Section 4*: checking if a product has web-to-print features then printing javascript code for web-to-print personalization form.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_js($this); ?>
  }}}

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/catalog/product/view/media.phtml template/catalog/product/view/media.phtml] ==
This file shows product image, additional images and image zoomer on product page.

New code checks for web-to-print in a product and puts correct images urls additional images.

*Section 1*: remove web-to-print images for multi-page templates from the gallery thumbs.
  {{{
<?php $this->helper('webtoprint/personalization-form')->prepare_gallery_images($this) ?>
  }}}

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/checkout/cart/item/default.phtml template/checkout/cart/item/default.phtml] ==
This file shows various information for cart item on shopping cart page.

New code checks for web-to-print in a product and puts correct images urls for cart item,
also it adds link to PDF proofs.

*Section 1*: checking if product has web-to-print features and then printing `img` tag with correct url; add link to PDF proof for the template.
  {{{
<?php if(!$this->helper('webtoprint/personalization-form')->get_cart_image($this)): ?>
  }}}

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/page/html/head.phtml template/page/html/head.phtml] ==
This file prints content of `<head>` tag for every page.

New code adds resources (css and js files) for web-to-print personalization form.

*Section 1*: printing `<link>` tags for every css and js files from web-to-print personalization form resorces.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_js_css_includes(); ?>
  }}}

*NOTE*: this function was deprecated since 1.8.1.0beta2 release. List of CSS and JavaScript files for web-to-print personalization form was moved to _[http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/layout/local.xml app/design/frontend/default/zptheme/layout/local.xml]_ file. Copy this file from zptheme to your custom theme's _layout_ directory.

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/sales/order/items.phtml template/sales/order/items.phtml] ==
This file show various information for order item on user orders page.

New code checks for web-to-print in a product and shows preview images for order items.

*Section 1*: add link to hide/show all previews one time
  {{{
<?php echo $this->helper('webtoprint/personalization-form')->show_hide_all_order_previews($this); ?>
  }}}

*Section 2*: add preview images for web-to-print products from the order.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_order_preview_images($this, $_item); ?>
  }}}

*Section 3*: add JavaScript code for preview images.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_js_for_order_preview_images($this); ?>
  }}}

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/sales/order/items/renderer/default.phtml template/sales/order/items/renderer/default.phtml] ==
This file shows various information for particular order item on user orders page.

The following ZP code shows links to generated output files (PDF/PNG/JPG/GIF) in order details. The links appear if the files were generated and the template config (in ZP) has _download by customer_ setting set to either _allow_ (a user can download files) or _only_ (the order is for downloading only, nothing gets printed). The function returns nothing if the conditions above are not met.

*Section 1*: inserting links to web-to-print generated files.
  {{{
<?php echo $this->helper('webtoprint/personalization-form')->get_order_webtoprint_links($this, $_item); ?>
  }}}

The following ZP code adds re-order link to an order item. After clicking on the link the corresponding product page will be opened and fields from personalization form will be filled with values from the order.

*Section 2*: insert re-order link.
  {{{
<?php echo $this->helper('webtoprint/personalization-form')->get_reorder_button($this, $_item); ?>
  }}}

== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zptheme/template/catalog/product/view/addto.phtml template/catalog/product/view/addto.phtml] ==
This file needs to be modified only of you want to show _Share preview_ link so that users can grab the URL of the image and share it with someone else. In this case the image is downloaded from ZP to your Magento site for keeping (ZP deletes unused images quickly). The download happens asynchronously when the user clicks on the sharing text box.

Preview downloading is initiated only then user clicks on text input with URL. All previews downloaded from ZetaPrints are saved in _media/tmp/catalog/product/previews/_ directory. The directory is created automatically during the extension installation process. Old preview images need to be removed manually from the temp directory.

The following ZP code adds link to show text field with sharing url for a generated preview. You can insert this function into any other place in the layout, which may be in a different file.

*Section 1*: add preview sharing link.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_preview_image_sharing_link(); ?>
  }}}

= Functions =
Most of the extension code is encapsulated in functions. The functions make all necessary checks of the context and return values only if needed. E.g. `get_text_fields ($context)` function returns nothing if the product has no web-to-print features. This way they do not affect products that have nothing to do with web-to-print.

  * `get_product_image ($context, $product)` - Outputs nothing, always returns _false_. (*Deprecated*)
  * `get_page_tabs ($context)` - outputs image tabs for multipage templates
  * `get_text_fields ($context)` - outputs text fields for products with web-to-print features
  * `get_image_fields ($context)` - outputs image fields (stock images, color picker) for products with web-to-print features
  * `get_preview_button ($context)` - outputs _Update preview_ button for products with web-to-print features
  * `get_js ($context)` - outputs javascript code for products with web-to-print features
  * `get_js_css_includes ($context)` - Outputs nothing, always returns _false_. (*Deprecated*)
  * `get_preview_images ($context)` - Outputs nothing, always returns _false_. (*Deprecated*)
  * `get_gallery_thumb ($context, $product, $image)` - Outputs nothing, always returns _false_. (*Deprecated*)
  * `get_gallery_image ($context)` - Outputs nothing, always returns _false_. (*Deprecated*)
  * `get_cart_image ($context)` - outputs a slightly modified `<img>` tag to prevent image resizing with correct image url and returns _true_ for products with web-to-print features
  * `get_order_preview_images ($context)` - outputs previews images for order.
  * `get_reorder_button ($context, $item)` - outputs A tag with link to re-order web-to-print product page.

= Adjust size for different images (preview, stock and user images) =
Preview are generated by [www.zetaprints.com www.zetaprints.com] at a certain default size. Magento can reduce the preview size, but cannot make it larger. If the preview provided by zetaprints.com is not large enough you need to [http://www.zetaprints.com/help/changing-default-previews/ generate a bigger one first].


Size of *preview images* can be changed in _[http://code.google.com/p/magento-w2p/source/browse/trunk/skin/frontend/default/zptheme/css/zp-style.css zp-style.css]_ file, see _a.zetaprints-template-preview img_ CSS selector.

{{{
a.zetaprints-template-preview img {
  max-width: 265px;
  ...
}
}}}


Size of *stock images* in a library scroll can be changed in _[http://code.google.com/p/magento-w2p/source/browse/trunk/skin/frontend/default/zptheme/css/zp-style.css zp-style.css]_ file for PNG and GIF and in _[http://code.google.com/p/magento-w2p/source/browse/trunk/app/code/local/ZetaPrints/Zpapi/Model/common-templates.xslt common-templates.xslt]_ file for other supported image types. By default every stock image is scaled down to 100px in height.

  * *PNG and GIF images*
  Change _max-width_ attribute in _div.images-scroller img_ CSS selector in _[http://code.google.com/p/magento-w2p/source/browse/trunk/skin/frontend/default/zptheme/css/zp-style.css zp-style.css]_ file.
{{{
div.images-scroller img {
  ...
  max-height: 100px;
  ...
}
}}}

  * *Other supported image types*
  Change _0x100_ part of image URL to preferred one where template is _WEIGHTxHEIGHT_ (in pixels) in _[http://code.google.com/p/magento-w2p/source/browse/trunk/app/code/local/ZetaPrints/Zpapi/Model/common-templates.xslt common-templates.xslt]_ file.
{{{
<xsl:otherwise>
  <img src="{$zetaprints-api-url}photothumbs/{substring-before(@Thumb,'.')}_0x100.{substring-after(@Thumb,'.')}" />
</xsl:otherwise>
}}}

Size of *user images* in library scroll can be changed in _[http://code.google.com/p/magento-w2p/source/browse/trunk/skin/frontend/default/zptheme/css/zp-style.css zp-style.css]_ file for PNG and GIF and in _[http://code.google.com/p/magento-w2p/source/browse/trunk/app/code/local/ZetaPrints/WebToPrint/Helper/PersonalizationForm.php PersonalizationForm.php]_ (for already uploaded images) and [http://code.google.com/p/magento-w2p/source/browse/trunk/app/code/local/ZetaPrints/WebToPrint/controllers/UploadController.php UploadController.php] (for newly uploaded images) files for other supported image types. By default every user image is scaled down to 100px in height.

  * *PNG and GIF images*
  Same as for PNG or GIF stock images.

  * *Other supported image types*
  Change _0x100_ value of parameter to preferred one where template is _WEIGHTxHEIGHT_ (in pixels) in _[http://code.google.com/p/magento-w2p/source/browse/trunk/app/code/local/ZetaPrints/WebToPrint/Helper/PersonalizationForm.php PersonalizationForm.php]_ and [http://code.google.com/p/magento-w2p/source/browse/trunk/app/code/local/ZetaPrints/WebToPrint/controllers/UploadController.php UploadController.php] files.
{{{
if ($image['mime'] === 'image/jpeg' || $image['mime'] === 'image/jpg')
  $thumbnail = str_replace('.', '_0x100.', $image['thumbnail']);
}}}
    

= NOSCRIPT =
Product personalisation form requires JavaScript. The form won't load fully if JS is disabled. Make sure your theme has `<NOSCRIPT>` area to warn customers about the requirement in a visible and informative way.


[http://www.zetaprints.com/magento-web-to-print/magento-partners http://www.zetaprints.com/help/img/magento_w2p_images/magento_support_text.png]