#summary Theme modifications for 1- or 2-Step personalization process.

= Introduction =

Normal products have a one step process: the product details page contains all the product options and the user adds it to cart on the same page.

Products with personalization can be sold in one step or two step process.
One step: all the options, including the personalization form appear on the same page.
Two step: the user chooses options and then proceeds to the personalization form.

The two step process uses additional functions from ZetaPrints extension. This document explains how the theme should be constructed.

= Two step process overview =

Both steps (options, personalization) use the same page. The code in the theme must make a choice which part of the page to show, depending on the context. Also, the second step should capture and retain all the parameters submitted from the first step.

== Implementation steps ==
  # Redirect _Add to cart_ request to product details page
  # Capture parameters submitted from _step 1_ in _step 2_
  # Choose if to show _step 1_ (options) or _step 2_ (personalization) form
  # Include params from _step 1_ into _Add to cart_ request at _step 2_

== Functions ==
  * `function is_personalization_step ($context)` - Returns _true_ if a request to a page contains _personalization_ parameter.
  * `function get_params_from_previous_step ($context)` - Returns list of `<input>` tags for params from _step 1_. All params are taken from a request to a page.
  * `function get_next_step_url ($context)` - Returns _true_ if next step is _step 2_ (personalization) and prints url for the product with additional _personalization_ param, otherwise it returns _false_.

== Affected files ==
=== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zp2steptheme/template/catalog/product/view.phtml zp2steptheme/template/catalog/product/view.phtml] ===
This file shows form for ordering on product page. This form contains product images, product name, product description, product price, etc.

*Section 1*: checking for current step and printing link for a next step. For _step 2_ (personalization) the link is the product page url with additional _personalization_ param. Otherwise it prints link for _add to cart_ action if the next is not a personalization.
  {{{
<?php if (!$this->helper('webtoprint/personalization-form')->get_next_step_url($this)) echo $this->getAddToCartUrl($_product) ?>
  }}}

*Section 2*: сhecking if the step is not _step 2_ (personalization) then show standard magento product page, otherwise it jumps into next section.
  {{{
<?php if(!$this->helper('webtoprint/personalization-form')->is_personalization_step($this)): ?>
  }}}

*Section 3*: showing web-to-print personalization form if current step is _step 2_ (personalization).

*Section 4*: checking if a product has web-to-print features then printing tabs component for switching pages in multipage templates.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_page_tabs($this); ?>
  }}}

*Section 5*: printing list of `input` tags for params from step 1 (options).
  {{{
<?php echo $this->helper('webtoprint/personalization-form')->get_params_from_previous_step($this); ?>
   }}}

*Section 6*: checking if а product has web-to-print features then printing text fields, stock images choosers, color pickers.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_text_fields($this); ?>
<?php $this->helper('webtoprint/personalization-form')->get_image_fields($this); ?>
  }}}

*Section 7*: checking if a product has web-to-print features then printing _Update preview_ button.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_preview_button($this); ?>
  }}}

*Section 8*: checking if a product has web-to-print features then printing javascript code for web-to-print personalization form.
  {{{
<?php $this->helper('webtoprint/personalization-form')->get_js($this); ?>
  }}}

=== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zp2steptheme/template/catalog/product/view/addtocart.phtml zp2steptheme/template/catalog/product/view/addtocart.phtml] ===
This file show _Add to cart_ button, qty input fields and some other information.

*Section 1*: checking if current step is _step 1_ (options) then show "Personalize" button, otherwise show "Add to cart" button.
  {{{
<?php if(!$this->helper('webtoprint/personalization-form')->is_personalization_step($this)): ?>
  }}}

*Section 2*: printing "Add to cart" button if current step is _step 2_ (personalization). 

=== [http://code.google.com/p/magento-w2p/source/browse/trunk/app/design/frontend/default/zp2steptheme/template/catalog/product/view/media.phtml zp2steptheme/template/catalog/product/view/media.phtml] ===
This file shows product image, additional images and image zoomer on product page.

*Section 1*: checking for personalization step and disabling image resizing for products with web-to-print feature.
  {{{
if ($this->helper('webtoprint/personalization-form')->is_personalization_step($this))
  $this->helper('webtoprint/personalization-form')->get_preview_images($this);
else
  if (!$this->helper('webtoprint/personalization-form')->get_preview_image($this))
    echo $_helper->productAttribute($_product, $_img, 'image');
}}}
== Application of 1- or 2-Step process ==
You can have 2 identical themes with the only difference in 1 or 2 step process. Choose the most commonly used theme as the default and enable the other theme for some products only.